@model Order
@inject Cart cart
<section class="cofirmation-menu">
  <div class="container">
    <div class="confirmation-wrapper">
      <div class="order-info">
        <div class="order-header">
          Оформление заказа
        </div>
        <div class="orders-wrapper">
          <div class="order-head">
            Вы заказали:
          </div>
          <div class="items-wrapper">
          @foreach(var line in cart.Lines){  
            <div class="cart-item"id="@line.Item.Id">
              <div class="item-delete">
                <div class="delete_btn">
                  <a asp-action="RemoveFormCart" asp-controller="Order" asp-route-ReturnUrl="@ViewContext.HttpContext.Request.Path.Value.ToString()" asp-route-itemid="@line.Item.Id" class="delete_btn">
                    <img src="~/img/x-delete.svg" />
                  </a>
                </div>
              </div>
              <div class="item-image"><img src=""/></div>
              <div class="item-name">@line.Item.Name</div>
              <div class="quantity">
                  <div class="b-minus">-</div>
                  <div class="digit-sm"><span class="jq">@line.Quantity</span></div>
                  <div class="b-plus">+</div>
                </div>
              <div class="item-summary"><span class="tot" id="digit">@line.ComputeLineTotal()</span> UAH</div>
            </div>              
          }
          </div>
        </div>
        <div class="bonus-footer">
          <div class="tabs-wrapper">
            <div class="tab-deliver active">
              Доставка
            </div>
            <div class="tab-selfdel">
              Самовывоз (- 20%)
            </div>
          </div>
          <div class="bonus-info-menu">
            <div class="total-sm">
              <div class="sum">
                <div class="label">
                  Итого
                </div>
                <div class="digit">
                  <span id="total">@cart.ComputeTotalValue()</span> UAH 
                </div>
              </div>
              <div class="del-bonus">
                <div class="label">
                  Доставка
                </div>
                <div class="digit">
                  <span id="discount-dig">100</span> UAH
                </div>
              </div>
            </div>
            <div class="total-total">
              <div class="total-label">
                Итого к оплате
              </div>
              <div class="total-sum">
                <span id="total-sum">@cart.ComputeTotalValue()</span> UAH
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="delivery-info">
        <div class="info-wrapper">
          <div class="deliver-district">
            <div class="label">
              Район доставки
            </div>
            <div class="input-val">
              <input placeholder="Выбрать">
            </div>
          </div>
          <div class="deliver-fio">
            <div class="label">
              ФИО
            </div>
            <div class="input-val">
              <input placeholder="Введите Ваше полное имя">
            </div>
          </div> 
          <div class="deliver-phone">
            <div class="label">
              Телефон
            </div>
            <div class="input-val">
              <input placeholder="+380">
            </div>
          </div>
          <div class="deliver-adress">
            <div class="label">
              Адрес доставки
            </div>
            <div class="input-val">
              <input placeholder="Введите адрес доставки">
            </div>
          </div>
          <div class="deliver-payment">
            <div class="label">
              <select class="form-select input-val" aria-label=".form-select-lg example">
                  <option selected>Способ оплаты</option>
                  <option value="1">Наличные</option>
                  <option value="2">Кредитная карта</option>
              </select>
            </div>
          </div> 
        </div>
        <a class="submit-btn">
          Оформить заказ
        </a>              
      </div>
    </div>
  </div>
</section>

<script>
    
</script>

<script>
    
</script>
<script>
    $(document).on("click", ".b-plus",function() {
        var item=$(this).closest(".cart-item");
        var id=item.attr("id");
        var quantity=item.find(".jq");
        var summary=item.find("#digit");
        $.post("/Order/IncrementJson",
        {itemId:id})
        .done(function(data){
            if(data.Quantity>1){
                quantity.text(data.Quantity);
                summary.text((data.Quantity*data.Price).toFixed(2).replace(".",","));
                ChangeTotal();
                TotalValue();
            }            
        });
    });
    $(document).on("click", ".b-minus",function() {
        var item=$(this).closest(".cart-item");
        var id=item.attr("id");
        var quantity=item.find(".jq");
        if(parseInt(quantity.text())>1){
            var summary=item.find("#digit");
            $.post("/Order/DecrementJson",
            {itemId:id})
            .done(function(data){
                if(data.Quantity>0){
                    quantity.text(data.Quantity);
                    summary.text((data.Quantity*data.Price).toFixed(2).replace(".",","));
                    ChangeTotal();
                    TotalValue();
                }
            });
        }       
    });

    function TotalValue(){
        if($(".tab-selfdel").hasClass("active")){
            var b=parseFloat($("#total").text());
            var c=b-(b/5);
            $("#total-sum").text(c.toFixed(2).replace(".",","));
        }
        else{
            var b=parseFloat($("#total").text());
            var discount=parseFloat($("#discount-dig").text());
            var c=b+discount;
            $("#total-sum").text(c.toFixed(2).replace(".",","));
        }
    };

    function ChangeTotal(){
        var sum=0;
        $(".tot").each(function(){
            sum+=parseInt($(this).text());
        });
        $("#total").text(sum.toFixed(2).replace(".",","));
    };
   
    $(document).on("click",".tab-selfdel",function(){
        $(this).addClass("active");
        $("#discount-dig").text("0");
        $(".tab-deliver").removeClass("active");
        $(".deliver-adress").hide();
        $(".deliver-district").hide();  
        TotalValue();
    });
    $(document).on("click",".tab-deliver",function(){
        $(this).addClass("active");
        $("#discount-dig").text("100");
        $(".tab-selfdel").removeClass("active");
        $(".deliver-adress").show();
        $(".deliver-district").show();
        TotalValue();
    });
</script>